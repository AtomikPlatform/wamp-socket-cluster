!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("jsonschema"),require("lodash.get")):"function"==typeof define&&define.amd?define("wampSocketCluster",["jsonschema","lodash.get"],r):"object"==typeof exports?exports.wampSocketCluster=r(require("jsonschema"),require("lodash.get")):e.wampSocketCluster=r(e.jsonschema,e["lodash.get"])}(this,function(e,r){return function(e){function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=8)}([function(e,r,t){"use strict";function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var n,o,i={id:"/WAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"number"},success:{type:"boolean"},type:{type:"string"}},required:["type","procedure","signature","success","error"]},u={id:"/WAMPRequest",type:"object",properties:{data:{},signature:{type:"number"},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},p={id:"/EventRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},c={id:"/MasterWAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},a={id:"/MasterWAMPRequest",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","type","procedure"]},d={id:"/InterProcessRPCResponseSchema",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},y={id:"/InterProcessRPCRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure"]},l={id:"/MasterConfigResponseSchema",type:"object",properties:{registeredEvents:{type:"array"},type:{type:"string"}},required:["registeredEvents","type"]},f={id:"/MasterConfigRequestSchema",type:"object",properties:{type:{type:"string"}},required:["type"]},g=(n={},s(n,i.id,u.id),s(n,c.id,u.id),s(n,d.id,y.id),s(n,l.id,f.id),n),m=(o={},s(o,u.id,i.id),s(o,a.id,i.id),s(o,y.id,d.id),s(o,f.id,l.id),o);e.exports={WAMPRequestSchema:u,WAMPResponseSchema:i,InterProcessRPCRequestSchema:y,InterProcessRPCResponseSchema:d,MasterWAMPResponseSchema:c,MasterWAMPRequestSchema:a,MasterConfigRequestSchema:f,MasterConfigResponseSchema:l,EventRequestSchema:p,resToReqMap:g,reqToResMap:m}},function(e,r){e.exports=require("jsonschema")},function(e,r){e.exports=require("lodash.get")},,,,,,function(e,r,t){"use strict";function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(r,t,s){return t&&e(r.prototype,t),s&&e(r,s),r}}(),o=t(2),i=t(1).Validator,u=t(0).WAMPResponseSchema,p=t(0).WAMPRequestSchema,c=new i,a=function(){function e(){s(this,e),this.callsResolvers={}}return n(e,null,[{key:"MAX_CALLS_ALLOWED",get:function(){return 1e3}}]),n(e,[{key:"upgradeToWAMP",value:function(r){var t=this;return r.on("raw",function(e){if(c.validate(e,u).valid&&e.type===u.id){var r=o(t.callsResolvers,e.procedure+"."+e.signature);if(!r)throw new Error("Unable to find resolving function for procedure "+e.procedure+" with signature "+e.signature);e.success?r.success(e.data):r.fail(e.error),delete t.callsResolvers[e.procedure][e.signature]}}),r.wampSend=function(s,n){return new Promise(function(o,i){if(t.callsResolvers[s]||(t.callsResolvers[s]={}),Object.keys(t.callsResolvers[s]).length>=e.MAX_CALLS_ALLOWED)return i("No more than "+e.MAX_CALLS_ALLOWED+" calls allowed");var u=Object.keys(t.callsResolvers[s]).length-1+1;t.callsResolvers[s][u]={success:o,fail:i},r.send(JSON.stringify({data:n,procedure:s,signature:u,type:p.id}))})},r}}]),e}();e.exports=a}])});