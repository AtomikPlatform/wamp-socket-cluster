!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("jsonschema"),require("lodash.get")):"function"==typeof define&&define.amd?define("wampSocketCluster",["jsonschema","lodash.get"],r):"object"==typeof exports?exports.wampSocketCluster=r(require("jsonschema"),require("lodash.get")):e.wampSocketCluster=r(e.jsonschema,e["lodash.get"])}(this,function(e,r){return function(e){function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=4)}([function(e,r,t){"use strict";function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var n,o,i=t(1).Validator,u=new i,p={id:"/WAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"string"},success:{type:"boolean"},type:{type:"string"}},required:["type","procedure","signature","success","error"]},a={id:"/WAMPRequest",type:"object",properties:{data:{},signature:{type:"string"},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},c={id:"/EventRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},d={id:"/MasterWAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},y={id:"/MasterWAMPRequest",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","type","procedure"]},l={id:"/InterProcessRPCResponseSchema",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},g={id:"/InterProcessRPCRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"string"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure"]},f={id:"/MasterConfigResponseSchema",type:"object",properties:{registeredEvents:{type:"array"},config:{type:"object"},type:{type:"string"}},required:["type"]},m={id:"/MasterConfigRequestSchema",type:"object",properties:{type:{type:"string"}},required:["type"]},h=(n={},s(n,p.id,a.id),s(n,d.id,a.id),s(n,l.id,g.id),s(n,f.id,m.id),n),b=(o={},s(o,a.id,p.id),s(o,y.id,p.id),s(o,g.id,l.id),s(o,m.id,f.id),o),R=function(e,r){return u.validate(e,r).valid&&e.type===r.id};e.exports={WAMPRequestSchema:a,WAMPResponseSchema:p,InterProcessRPCRequestSchema:g,InterProcessRPCResponseSchema:l,MasterWAMPResponseSchema:d,MasterWAMPRequestSchema:y,MasterConfigRequestSchema:m,MasterConfigResponseSchema:f,EventRequestSchema:c,resToReqMap:h,reqToResMap:b,isValid:R}},function(e,r){e.exports=require("jsonschema")},function(e,r){e.exports=require("lodash.get")},,function(e,r,t){"use strict";function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var n=function(){function e(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(r,t,s){return t&&e(r.prototype,t),s&&e(r,s),r}}(),o=t(2),i=t(0),u=function(){function e(){s(this,e),this.callsResolvers={}}return n(e,null,[{key:"generateSignature",value:function(e){return(new Date).getTime()+"_"+(Object.keys(e).length-1+1)}},{key:"MAX_CALLS_ALLOWED",get:function(){return 100}}]),n(e,[{key:"upgradeToWAMP",value:function(r){var t=this;return r.wampSend&&r.listeners("raw").length?r:(r.on("raw",function(e){if(i.isValid(e,i.WAMPResponseSchema)){var r=o(t.callsResolvers,e.procedure+"."+e.signature);if(!r)throw new Error("Unable to find resolving function for procedure "+e.procedure+" with signature "+e.signature);e.success?r.success(e.data):r.fail(e.error),delete t.callsResolvers[e.procedure][e.signature]}}),r.wampSend=function(s,n){return new Promise(function(o,u){if(t.callsResolvers[s]||(t.callsResolvers[s]={}),Object.keys(t.callsResolvers[s]).length>=e.MAX_CALLS_ALLOWED)return u("No more than "+e.MAX_CALLS_ALLOWED+" calls allowed");var p=e.generateSignature(t.callsResolvers[s]);t.callsResolvers[s][p]={success:o,fail:u},r.send(JSON.stringify({data:n,procedure:s,signature:p,type:i.WAMPRequestSchema.id}))})},r)}}]),e}();e.exports=u}])});