!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("jsonschema"),require("lodash.get")):"function"==typeof define&&define.amd?define("wampSocketCluster",["jsonschema","lodash.get"],r):"object"==typeof exports?exports.wampSocketCluster=r(require("jsonschema"),require("lodash.get")):e.wampSocketCluster=r(e.jsonschema,e["lodash.get"])}(this,function(e,r){return function(e){function r(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:s})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=8)}([function(e,r,t){"use strict";function s(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var o,n,i=t(1).Validator,c=new i,p={id:"/WAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"number"},success:{type:"boolean"},type:{type:"string"}},required:["type","procedure","signature","success","error"]},u={id:"/WAMPRequest",type:"object",properties:{data:{},signature:{type:"number"},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},a={id:"/EventRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},type:{type:"string"}},required:["type","procedure"]},d={id:"/MasterWAMPResponse",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},y={id:"/MasterWAMPRequest",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","type","procedure"]},l={id:"/InterProcessRPCResponseSchema",type:"object",properties:{data:{},error:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},success:{type:"boolean"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure","success"]},f={id:"/InterProcessRPCRequestSchema",type:"object",properties:{data:{},procedure:{type:"string"},signature:{type:"number"},socketId:{type:"string"},type:{type:"string"},workerId:{type:"number"}},required:["workerId","socketId","signature","type","procedure"]},g={id:"/MasterConfigResponseSchema",type:"object",properties:{registeredEvents:{type:"array"},config:{type:"object"},type:{type:"string"}},required:["type"]},m={id:"/MasterConfigRequestSchema",type:"object",properties:{type:{type:"string"}},required:["type"]},b={id:"/BroadcastSchema",type:"object",properties:{type:{type:"string"},procedure:{type:"string"},workerId:{type:"number"}},required:["type"]},h=(o={},s(o,p.id,u.id),s(o,d.id,u.id),s(o,l.id,f.id),s(o,g.id,m.id),s(o,b.id,b.id),o),R=(n={},s(n,u.id,p.id),s(n,y.id,p.id),s(n,f.id,l.id),s(n,m.id,g.id),s(n,b.id,b.id),n),q=function(e,r){return c.validate(e,r).valid&&e.type===r.id};e.exports={BroadcastSchema:b,WAMPRequestSchema:u,WAMPResponseSchema:p,InterProcessRPCRequestSchema:f,InterProcessRPCResponseSchema:l,MasterWAMPResponseSchema:d,MasterWAMPRequestSchema:y,MasterConfigRequestSchema:m,MasterConfigResponseSchema:g,EventRequestSchema:a,resToReqMap:h,reqToResMap:R,isValid:q}},function(e,r){e.exports=require("jsonschema")},function(e,r){e.exports=require("lodash.get")},,,,,,function(e,r,t){"use strict";function s(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,r){for(var t=0;t<r.length;t++){var s=r[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(r,t,s){return t&&e(r.prototype,t),s&&e(r,s),r}}(),n=t(2),i=t(0),c=function(){function e(){s(this,e),this.callsResolvers={}}return o(e,null,[{key:"MAX_CALLS_ALLOWED",get:function(){return 1e3}}]),o(e,[{key:"upgradeToWAMP",value:function(r){var t=this;return r.on("raw",function(e){if(i.isValid(e,i.WAMPResponseSchema)){console.log("[36m%s[0m","WAMPClient ----- GET VALID RESPONSE --- procedure / success",e.procedure,e.success,t.callsResolvers);var r=n(t.callsResolvers,e.procedure+"."+e.signature);if(!r)throw new Error("Unable to find resolving function for procedure "+e.procedure+" with signature "+e.signature);e.success?r.success(e.data):r.fail(e.error),delete t.callsResolvers[e.procedure][e.signature]}}),r.wampSend=function(s,o){return new Promise(function(n,c){if(t.callsResolvers[s]||(t.callsResolvers[s]={}),Object.keys(t.callsResolvers[s]).length>=e.MAX_CALLS_ALLOWED)return c("No more than "+e.MAX_CALLS_ALLOWED+" calls allowed");var p=(new Date).getTime();t.callsResolvers[s][p]={success:n,fail:c},console.log("[36m%s[0m","WAMPClient ----- SEND WAMP RPC ---",s,o),r.send(JSON.stringify({data:o,procedure:s,signature:p,type:i.WAMPRequestSchema.id}))})},r}}]),e}();e.exports=c}])});